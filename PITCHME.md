### sortのマルチコア対応状況について調べてみた
itosue

---

メニーコア化が進んでいる中、UNIXの標準コマンドはどうなってるのか?

中でもシェル芸や実務で使用頻度が高いと思われるsortについて取り上げてみようと思います。

---

sortコマンドの実行速度が違う　要素→（parallel・Mac内蔵vsGNU・システムのスケジューリング）


---

コマンド | オプション無し | --parallel=N(最大コア数) | --parallel=1
---------------- | ----------------- | ----------------- | -----------------
sort@mac | 49.846s | オプション存在せず | オプション存在せず
gsort@mac | 33.772s | 34.223s(4) | 46.422s
sort@Azure1 | 29.213s | 29.093s(8) | 1m12.125s
sort@Azure2 | 29.255s | 28.413s(8) | 1m10.404s
- 一番速いのはAzureの４コア実行だった 0m25.857s (実行時間無指定比約11.5%減) |
- 8.27では25.414s |

+++

### 実行環境
コマンド | バージョン | CPU （カッコ内はTB使用時最大クロック）| 備考
---------------- | ----------------- | ----------------- | -----------------
sort@mac | 5.93(2005) | Core i5 2.4GHz(2.9GHz) 2C4T | MBP late2013に最初から入ってるやつ
gsort@mac | 8.27(2017) | 同上 | brew install coreutilsで入ったやつ
sort@Azure1 | 8.22(2013) | Xeon E5-2660 2.20GHz(3GHz) 8C8T | CentOS 7.3に最初から入ってるやつ (VMのサイズはA8v2:Rogue Wave Softwareのイメージを使用)
sort@Azure2 | 8.27(2017) | Xeon E5-2660 2.20GHz(3GHz) 8C8T | ソースからビルド

+++

parallelオプションの指定数 | real | user | sys
---------------- | ----------------- | ----------------- | -----------------
指定なし | 0m29.213s | 1m19.394s | 0m6.939s
8　 | 0m29.093s | 1m18.474s | 0m7.179s
7 | 0m34.568s | 1m17.627s | 0m6.487s
6 | 0m34.659s | 1m15.957s | 0m6.349s
5 | 0m34.826s | 1m15.393s | 0m5.900s
4 | 0m25.857s | 1m6.435s | 0m5.174s
3 | 0m39.054s | 1m6.009s | 0m4.153s
2 | 0m38.560s | 1m4.328s | 0m3.362s
1 | 1m12.125s | 1m8.997s | 0m3.100s

---

### 結論
* 標準ツール結構進化してる!
* そのままでも程々に分散処理してくれる
* 使うコア数が多ければ良いというものではない
* TBや別で動いてる処理を考慮すれば処理速度がアップする
